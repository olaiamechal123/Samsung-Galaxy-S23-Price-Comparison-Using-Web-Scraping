from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager
from bs4 import BeautifulSoup
import pandas as pd
from datetime import datetime
import time

# Configurer Selenium (navigateur Chrome)
options = webdriver.ChromeOptions()
options.add_argument("--headless")  
options.add_argument("user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36")

driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)

# URL du produit (remplacez par l'URL réelle)
url = "https://www.ebay.fr/itm/267445008422?_skw=Samsung+Galaxy+S23&itmmeta=01K88TZZYN37ZQPP78C3E7G084&hash=item3e44f6f826:g:688AAeSwMuNo-NxT&itmprp=enc%3AAQAKAAAA8FkggFvd1GGDu0w3yXCmi1dsuiu%2FFpo5rN%2BoLNQr1VmCL74ym3Bkx9MeCTQQWMeWjqNFGi4YqiTgEfSQFlC%2B0xS9JXoTV14i4eyNx%2Fri%2F0K4xlZJPGHn35UFUPayc3508k5mSmzy4CPurJSY9Av13RSkEjKYx83QRX61cUaHX3UlrHlQNAPgVwqLx90IvtTQ2uDDFeDYy%2F2eZ0SOgtc5c3sksT%2FR%2FyxHXexecia8eFOPoxr6fEQAvdnbRd21k79ixdOxfAlKAx1FCeDJKiAATEMu4t8zED20mKl9Iz44FhQTBLRBcg%2BS%2BlvBe5piqgkY8Q%3D%3D%7Ctkp%3ABk9SR7z__5rCZg"

try:
    # Accéder à la page
    print("Chargement de la page eBay...")
    driver.get(url)
    time.sleep(3)  # Attendre 3 secondes pour le chargement

    # Analyser le HTML
    print("Analyse du HTML...")
    soup = BeautifulSoup(driver.page_source, 'html.parser')

    # Extraire le nom du produit
    nom_produit = soup.find('span', class_='ux-textspans ux-textspans--BOLD')
    nom_produit = nom_produit.text.strip() if nom_produit else "Nom non trouvé"
    print(f"Produit : {nom_produit}")

    # Extraire le prix
    prix_element = soup.find('div', class_='x-price-primary')
    prix = prix_element.text.strip() if prix_element else "Prix non trouvé"
    print(f"Prix : {prix}")

    

    # Sauvegarder dans un fichier CSV
    print("Sauvegarde des données...")
    data = {
        'Produit': [nom_produit],
        'Prix': [prix],
        'Date': [datetime.now().strftime('%Y-%m-%d %H:%M:%S')],
        'Site': ['ebay']
    }
    df = pd.DataFrame(data)
    df.to_csv('prix_samsung_galaxy_s23_ebay.csv', mode='a', index=False, header=not pd.io.common.file_exists('prix_samsung_galaxy_s23_ebay.csv'))
    print("Données sauvegardées dans prix_samsung_galaxy_s23_ebay.csv")

except Exception as e:
    print(f"Erreur : {e}")

finally:
    # Fermer le navigateur
    driver.quit()
    print("Navigateur fermé.")